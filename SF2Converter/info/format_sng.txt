GoatTracker 2 file format
=========================

Researched for SF2Converter (SID Factory II) by Jens-Christian Huus.

Pos             Size        Example         Notes

0000            0x03        GTS             File format identifier bytes
0003            0x01        5               GT file format version (5 is the latest and its format is shown here)
                                            1 ("!") was GoatTracker 1 - converting from it is quite complicated
                                            2 only used 3 tables instead of 4 - converting from it looks tolerable
                                            3, 4 and 5 all appear to be acceptable
AUTHOR INFO

0004            0x20        Georgia         Song name (padded with zeroes)
0024            0x20        Ray Charles     Author (padded with zeroes)
0044            0x20        2020 Earth      Year and copyright (padded with zeroes)

ORDER LISTS

--------
                                                If both repeat and transpose is used, transpose always come first
    Patterns            00-CF
    Repeat              Dx                      x   =  number of repeats (0-F) - note that 0 is 16 times!
    Transpose down      Ex                      x   =  halftones (1-F) - 1 to 15
    Transpose up        Fx                      x   =  halftones (0-E) - 0 to 14
    End of order list   FF xx                   xx  =  wrap position byte (00 = beginning)

--------

0064            0x01                        Number of subtunes 01-20 (usually 01)

0065            0x01                        Size of order list in bytes (including 0xFF end byte)
0066           [0065]       01 01 01...     Order list (including 0xFF end byte) for channel 1
0100 *                                      Let's assume we're here now
0100            0x01                        Loop - 00 means from the beginning

0101            0x01                        Size of order list in bytes (including 0xFF end byte)
0102           [0101]       08 09 0a...     Order list (including 0xFF end byte) for channel 2
0200 *                                      Let's assume we're here now
0200            0x01                        Loop - 00 means from the beginning

0201            0x01                        Size of order list in bytes (including 0xFF end byte)
0202           [0201]       12 13 13...     Order list (including 0xFF end byte) for channel 3
0300 *                                      Let's assume we're here now
0300            0x01                        Loop - 00 means from the beginning

(....                                       More sets of three channel order lists repeated for additional sub tunes)

INSTRUMENTS

0301            0x01                        Number of instruments in bytes (each 9 bytes data + 16 bytes instrument name)

                                            Instrument 00 is always empty and is not stored. 01 is the first instrument.

0302            0x01                        Attack/Decay
0303            0x01                        Sustain/Release
0304            0x01                        Wave table position (00 stops execution)
0305            0x01                        Pulse table position (00 stops execution)
0306            0x01                        Filter table position (00 stops execution)
0307            0x01                        Vibrato index to speed table (for a value like 4xy command)
0308            0x01                        Vibrato delay (number of frames until vibrato starts - 00 turns vibrato off)
0309            0x01        02              HR/Gate timer (max is tempo-1) - 80 disables HR and 40 disables gate off
030a            0x01        09              First frame waveform - FE is leave waveform unchanged + gate off, FF is gate on, 00 is gate unchanged

030b            0x10        Bass            Instrument name

(031b                                       More instruments...)

DATA TABLES

0800 *                                      Let's assume we're here now

0800            0x01                        Size of wave table (actual data only)
0801           [0800]                       Left byte column in table (waveforms) up to and including last FF
0801 + [0800]  [0800]                       Right byte column in table (frequency values)

--------

    WAVE TABLE

    Left column                                                     Right column

    00      Leave waveform unchanged (MOD-style)                    00-5F   Relative notes
    01-0F   Delay this step by 1-15 frames (allows effects)         60-7F   Negative relative notes (lower pitch)
    10-DF   Waveform values                                         80      Keep frequency unchanged (allows effects)
    E0-EF   Inaudible waveforms 00-0F                               81-DF   Absolute notes C#0 to B-7
    F0-FE   Execute command 0xx-Exx; right side is parameter
    FF      Jump to position (00 = stop)

--------

0a00 *                                      Let's assume we're here now

0a00            0x01                        Size of pulse table (actual data only)
0a01           [0a00]                       Left byte column in table
0a01 + [0a00]  [0a00]                       Right byte column in table

--------

    PULSE TABLE

    Left column                                 Right column

    01-7F   Pulse modulation time               and speed (00-7F for up or FF-80 for down)
    8x-Fx   Set pulse width, high 4 bits        and low 8 bits
    FF      Jump to position (00 = stop)

--------

0c00 *                                      Let's assume we're here now

0c00            0x01                        Size of filter table (actual data only)
0c01           [0c00]                       Left byte column in table
0c01 + [0c00]  [0c00]                       Right byte column in table

--------

    FILTER TABLE

    Left column                                 Right column

    00      Set cutoff                          to this byte value - no player wait; reads next row immediately
    01-7F   Filter modulation time              and speed (00-7F for up or FF-80 for down)
    80-F0   Set filter passband                 and resonance nibble (0-F) + channel bitmask (0-7) - no player wait; reads next row immediately
    FF      Jump to position (00 = stop)

--------

0e00 *                                      Let's assume we're here now

0e00            0x01                        Size of speed table (actual data only)
0e01           [0e00]                       Left byte column in table
0e01 + [0e00]  [0e00]                       Right byte column in table

--------

    SPEED TABLE

    Vibrato             XX YY           XX = speed, YY = depth - bit 7 set in XX enables hi-fi calculation with YY as divisor
    Portamento          XX YY           Adds 16-bit XXYY to pitch - bit 7 set in XX enables hi-fi calculation with YY as divisor
    Funk tempo          XX YY           Alternates between the XX and YY speeds

--------

PATTERNS

1000 *                                      Let's assume we're here now

1000            0x01                        Number of patterns (each 1 byte size - and then size * 4 bytes below)
                                            GT2 can have 208 patterns > 127 sequences in SF2

1001            0x01                        Multiply this size byte with 4 to get true length of pattern
1002         [1001] * 4                     Pattern data with 4 bytes for each pattern event

--------

    EVENTS              4 bytes each:

                        0x01                    Note = 60-BC for C-0 to G#7, rest (does nothing - old 5F) = BD, note off = BE (old 5E), note on = BF
                        0x01                    Instrument 01-3F (00 means no change)
                        0x01                    Command 00-0F (the high nibble is not visible in the editor)
                        0x01                    Data for the command 00-FF

                                                The end of a pattern is FF 00 00 00
--------

(....                                       Patterns are repeated like this up to the last FF 00 00 00 event - and that is the end of file)

--------

    COMMANDS

    Nothing             0xx                     Data is always 00
    Slide up            1xx                     xx  =  index to 16-bit value in speed table                 Repeated each event for MOD compatibility
    Slide down          2xx                     xx  =  index to 16-bit value in speed table                 Repeated each event for MOD compatibility
    Portamento          3xx                     xx  =  index to 16-bit value in speed table                 Repeated each event for MOD compatibility
    Vibrato             4xx                     xx  =  index to xx = speed and yy = depth in speed table    Repeated each event for MOD compatibility

                                                If the command is not 1xx-4xy, instrument vibrato will be active. Also, the following
                                                one-shot commands allow them to continue in the meantime.

    Attack/Decay        5xy                     x   =  attack, y  =  decay (only works on a note)
    Sustain/Release     6xy                     x   =  sustain, y  =  release (only works on a note)
    Set waveform        7xx                     xx  =  waveform (overridden by any wave table action)
    Wave table ptr      8xx                     xx  =  position in wave table (00 stops execution)
    Pulse table ptr     9xx                     xx  =  position in pulse table (00 stops execution)
    Filter table ptr    Axx                     xx  =  position in filter table (00 stops execution)
    Filter control      Bxy                     x   =  resonance, y  =  channel bitmask (00 both turns filter off and stops filter table execution)
    Filter cutoff       Cxx                     xx  =  cutoff value (overridden by any filter table action)
    Master volume       Dxy                     x   =  if 0, set master volume to y - if x != 0, set player address + 0x003F to xy (demo flag)
    Funk tempo          Exx                     xx  =  index to byte in speed table (speed alternates between the nibbles)
    Set tempo           Fxx                     xx  =  set tempo 03-7F on all channels - 83-FF set (& 7F) on current channel only - 00-01 recalls funk tempo set by Exx command

--------
